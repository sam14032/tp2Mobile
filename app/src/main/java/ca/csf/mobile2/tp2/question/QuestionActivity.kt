package ca.csf.mobile2.tp2.question

import android.annotation.SuppressLint
import android.support.v7.app.AppCompatActivity
import ca.csf.mobile2.tp2.R
import ca.csf.mobile2.tp2.databinding.ActivityQuestionBinding
import org.androidannotations.annotations.*

@SuppressLint("Registered") //Reason : Generated by Android Annotations
@DataBound
@EActivity(R.layout.activity_question)
class QuestionActivity : AppCompatActivity() {

    @Bean
    protected lateinit var questionService: QuestionService

    @InstanceState
    protected lateinit var viewModel: QuestionActivityViewModel

    protected fun onCreate(@BindingObject dataBinder: ActivityQuestionBinding) {
        if (!this::viewModel.isInitialized) {
            viewModel = QuestionActivityViewModel()
            getNewQuestion()
        }

        dataBinder.viewModel = viewModel
    }

    protected fun getNewQuestion() {
        questionService.getRandomQuestion(this::onSuccess, this::onConnectivityError, this::onServerError)
    }

    override fun onResume() {
        super.onResume()
        viewModel.onResume()
    }

    override fun onPause() {
        super.onPause()
        viewModel.onPause()
    }

    @Click(R.id.choice1_button)
    protected fun onChoice1ButtonClicked() {
        viewModel.onChoice1ButtonClicked()
    }

    @Click(R.id.choice2_button)
    protected fun onChoice2ButtonClicked() {
        viewModel.onChoice2ButtonClicked()
    }

    @Click(R.id.retry_button)
    protected fun onRetryButtonClicked() {
        viewModel.onRetryButtonClicked()
    }

    fun onSuccess(questionOutputDTO: QuestionOutputDTO) {
        viewModel.onSuccess()
    }

    fun onConnectivityError() {
        viewModel.onConnectivityError()
    }

    fun onServerError(errorCode : Int) {
        viewModel.onServerError()
    }
}
